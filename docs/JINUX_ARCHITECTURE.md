# Jinux æ•´ä½“æ¶æ„è¯´æ˜

**ç‰ˆæœ¬**ï¼š0.01-alpha  
**æœ€åæ›´æ–°**ï¼š2024-12-23

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
3. [æ ¸å¿ƒæ¨¡å—è¯¦è§£](#æ ¸å¿ƒæ¨¡å—è¯¦è§£)
4. [æ•°æ®æµå’Œæ§åˆ¶æµ](#æ•°æ®æµå’Œæ§åˆ¶æµ)
5. [å…³é”®è®¾è®¡å†³ç­–](#å…³é”®è®¾è®¡å†³ç­–)
6. [ä¸ Linux 0.01 çš„å¯¹åº”å…³ç³»](#ä¸-linux-001-çš„å¯¹åº”å…³ç³»)

---

## æ¦‚è¿°

Jinux æ˜¯ä¸€ä¸ªç”¨ Java å®ç°çš„ Linux 0.01 æ“ä½œç³»ç»Ÿæ¨¡æ‹Ÿå™¨ï¼Œé‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œå®Œæ•´å®ç°äº†æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬è¿›ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†ã€æ–‡ä»¶ç³»ç»Ÿã€è®¾å¤‡é©±åŠ¨ã€ç³»ç»Ÿè°ƒç”¨ç­‰ã€‚

### è®¾è®¡ç›®æ ‡

- **æ•™å­¦å‹å¥½**ï¼šæ¸…æ™°çš„é¢å‘å¯¹è±¡è®¾è®¡ï¼Œæ˜“äºç†è§£å’Œå­¦ä¹ 
- **é«˜åº¦è¿˜åŸ**ï¼šå¿ å®æ¨¡æ‹Ÿ Linux 0.01 çš„æ ¸å¿ƒæœºåˆ¶
- **åŠŸèƒ½å®Œæ•´**ï¼šå®ç°æ“ä½œç³»ç»Ÿçš„ä¸»è¦åŠŸèƒ½æ¨¡å—
- **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºæ·»åŠ æ–°åŠŸèƒ½

---

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·æ€ (User Space)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  InitProcess (PID 1)                                   â”‚  â”‚
â”‚  â”‚  - ç³»ç»Ÿåˆå§‹åŒ–è¿›ç¨‹                                      â”‚  â”‚
â”‚  â”‚  - å¯åŠ¨ Shell                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SimpleShell                                          â”‚  â”‚
â”‚  â”‚  - äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢                                   â”‚  â”‚
â”‚  â”‚  - æ”¯æŒç®¡é“ã€é‡å®šå‘ã€åå°æ‰§è¡Œ                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  LibC (ç”¨æˆ·æ€åº“)                                      â”‚  â”‚
â”‚  â”‚  - ç³»ç»Ÿè°ƒç”¨å°è£…                                       â”‚  â”‚
â”‚  â”‚  - 35+ å‡½æ•°æ¥å£                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â†“ ç³»ç»Ÿè°ƒç”¨æ¥å£ (syscall)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    å†…æ ¸æ€ (Kernel Space)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SystemCallDispatcher                                 â”‚  â”‚
â”‚  â”‚  - ç³»ç»Ÿè°ƒç”¨åˆ†å‘å™¨                                     â”‚  â”‚
â”‚  â”‚  - 28 ä¸ªç³»ç»Ÿè°ƒç”¨å®ç°                                  â”‚  â”‚
â”‚  â”‚  - ç”¨æˆ·ç©ºé—´æ•°æ®æ‹·è´                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Scheduler â”‚MemoryMgr â”‚   VFS    â”‚  Signal  â”‚Program   â”‚  â”‚
â”‚  â”‚ (è°ƒåº¦)   â”‚ (å†…å­˜)   â”‚ (æ–‡ä»¶)   â”‚ (ä¿¡å·)   â”‚Loader    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â†“                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Device Drivers + IPC                                â”‚  â”‚
â”‚  â”‚  Console â”‚ Disk â”‚ Clock â”‚ Pipe                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              ç¡¬ä»¶æŠ½è±¡å±‚ (Hardware Abstraction)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PhysicalMemory â”‚ VirtualDiskDevice                  â”‚  â”‚
â”‚  â”‚  - 16MB ç‰©ç†å†…å­˜æ¨¡æ‹Ÿ                                  â”‚  â”‚
â”‚  â”‚  - 10MB è™šæ‹Ÿç£ç›˜                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†å±‚æ¶æ„

Jinux é‡‡ç”¨ç»å…¸çš„åˆ†å±‚æ¶æ„ï¼Œä»ä¸Šåˆ°ä¸‹åˆ†ä¸ºï¼š

1. **ç”¨æˆ·æ€å±‚**ï¼šç”¨æˆ·ç¨‹åºå’Œ Shell
2. **ç³»ç»Ÿè°ƒç”¨æ¥å£å±‚**ï¼šç³»ç»Ÿè°ƒç”¨åˆ†å‘å’Œå‚æ•°å¤„ç†
3. **å†…æ ¸æ ¸å¿ƒå±‚**ï¼šè¿›ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†ã€æ–‡ä»¶ç³»ç»Ÿç­‰
4. **è®¾å¤‡é©±åŠ¨å±‚**ï¼šè®¾å¤‡æŠ½è±¡å’Œé©±åŠ¨å®ç°
5. **ç¡¬ä»¶æŠ½è±¡å±‚**ï¼šç‰©ç†å†…å­˜å’Œè™šæ‹Ÿè®¾å¤‡æ¨¡æ‹Ÿ

---

## æ ¸å¿ƒæ¨¡å—è¯¦è§£

### 1. å¯åŠ¨å¼•å¯¼æ¨¡å— (boot/)

#### Bootstrap.java
- **åŠŸèƒ½**ï¼šç³»ç»Ÿå¯åŠ¨å…¥å£
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `boot/bootsect.s`
- **èŒè´£**ï¼š
  - æ‰“å°å¯åŠ¨æ¨ªå¹…
  - åˆ›å»ºå†…æ ¸å®ä¾‹
  - åˆå§‹åŒ–å†…æ ¸
  - åˆ›å»º init è¿›ç¨‹
  - å¯åŠ¨ç³»ç»Ÿ

**å¯åŠ¨æµç¨‹**ï¼š
```
Bootstrap.main()
  â†’ Kernel()
  â†’ kernel.init()
  â†’ kernel.createInitProcess()
  â†’ kernel.start()
```

---

### 2. å†…æ ¸æ ¸å¿ƒæ¨¡å— (kernel/)

#### Kernel.java - å†…æ ¸ä¸»ç±»
- **åŠŸèƒ½**ï¼šå†…æ ¸åˆå§‹åŒ–å’Œåè°ƒ
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `kernel/main.c`
- **æ ¸å¿ƒç»„ä»¶**ï¼š
  - `MemoryManager` - å†…å­˜ç®¡ç†å™¨
  - `Scheduler` - è¿›ç¨‹è°ƒåº¦å™¨
  - `SystemCallDispatcher` - ç³»ç»Ÿè°ƒç”¨åˆ†å‘å™¨
  - `VirtualFileSystem` - è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ
  - å„ç§è®¾å¤‡é©±åŠ¨

**åˆå§‹åŒ–é¡ºåº**ï¼š
1. åˆ›å»ºå†…å­˜ç®¡ç†å™¨
2. åˆ›å»ºè°ƒåº¦å™¨
3. åˆ›å»ºç³»ç»Ÿè°ƒç”¨åˆ†å‘å™¨
4. åˆå§‹åŒ–è®¾å¤‡ï¼ˆæ§åˆ¶å°ã€ç£ç›˜ã€æ—¶é’Ÿï¼‰
5. åˆå§‹åŒ–æ–‡ä»¶ç³»ç»Ÿ
6. åˆ›å»º init è¿›ç¨‹

#### Task.java - è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰
- **åŠŸèƒ½**ï¼šè¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹çš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `include/linux/sched.h` ä¸­çš„ `task_struct`
- **æ ¸å¿ƒå­—æ®µ**ï¼š
  ```java
  - pid, ppid          // è¿›ç¨‹ ID å’Œçˆ¶è¿›ç¨‹ ID
  - state              // è¿›ç¨‹çŠ¶æ€ï¼ˆRUNNING, INTERRUPTIBLE, etc.ï¼‰
  - counter, priority  // æ—¶é—´ç‰‡å’Œä¼˜å…ˆçº§
  - addressSpace       // åœ°å€ç©ºé—´ï¼ˆé¡µè¡¨ã€æ®µä¿¡æ¯ï¼‰
  - fdTable            // æ–‡ä»¶æè¿°ç¬¦è¡¨
  - signalPending      // å¾…å¤„ç†ä¿¡å·ä½å›¾
  - signalHandlers     // ä¿¡å·å¤„ç†å™¨æ•°ç»„
  - utime, stime       // ç”¨æˆ·æ€å’Œå†…æ ¸æ€è¿è¡Œæ—¶é—´
  ```

#### Scheduler.java - è¿›ç¨‹è°ƒåº¦å™¨
- **åŠŸèƒ½**ï¼šè¿›ç¨‹è°ƒåº¦å’Œæ—¶é—´ç‰‡ç®¡ç†
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `kernel/sched.c`
- **è°ƒåº¦ç®—æ³•**ï¼šæ—¶é—´ç‰‡è½®è½¬ + ä¼˜å…ˆçº§è°ƒåº¦
  ```java
  // Linux 0.01 åŸå§‹è°ƒåº¦ç®—æ³•
  // é€‰æ‹© counter æœ€å¤§çš„å¯è¿è¡Œè¿›ç¨‹
  // è‹¥æ‰€æœ‰è¿›ç¨‹ counter=0ï¼Œé‡æ–°åˆ†é…æ—¶é—´ç‰‡
  counter = counter/2 + priority
  ```
- **æ ¸å¿ƒæ–¹æ³•**ï¼š
  - `schedule()` - é€‰æ‹©ä¸‹ä¸€ä¸ªè¿è¡Œçš„è¿›ç¨‹
  - `timerInterrupt()` - æ—¶é’Ÿä¸­æ–­å¤„ç†
  - `addTask()` / `removeTask()` - è¿›ç¨‹ç®¡ç†

#### SystemCallDispatcher.java - ç³»ç»Ÿè°ƒç”¨åˆ†å‘å™¨
- **åŠŸèƒ½**ï¼šç³»ç»Ÿè°ƒç”¨åˆ†å‘å’Œå¤„ç†
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `kernel/system_call.s`
- **å·²å®ç°ç³»ç»Ÿè°ƒç”¨**ï¼ˆ28ä¸ªï¼‰ï¼š
  - **è¿›ç¨‹ç®¡ç†**ï¼šfork, exit, wait, getpid, getppid, pause, execve
  - **ä¿¡å·ç®¡ç†**ï¼šsignal, kill
  - **æ–‡ä»¶æ“ä½œ**ï¼šread, write, open, close, lseek, creat, unlink
  - **ç›®å½•æ“ä½œ**ï¼šchdir, mkdir, rmdir
  - **æ–‡ä»¶çŠ¶æ€**ï¼šstat, fstat
  - **å†…å­˜ç®¡ç†**ï¼šbrk
  - **æ—¶é—´**ï¼štime, times
  - **IPC**ï¼špipe
  - **æ–‡ä»¶æè¿°ç¬¦**ï¼šdup, dup2
  - **æ–‡ä»¶ç³»ç»Ÿ**ï¼šsync

#### Signal.java - ä¿¡å·æœºåˆ¶
- **åŠŸèƒ½**ï¼šä¿¡å·å¤„ç†å’Œåˆ†å‘
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `kernel/signal.c`
- **æ”¯æŒä¿¡å·**ï¼š32 ç§ Unix æ ‡å‡†ä¿¡å·
- **ç‰¹æ€§**ï¼š
  - SIG_DFLï¼ˆé»˜è®¤ï¼‰ã€SIG_IGNï¼ˆå¿½ç•¥ï¼‰ã€è‡ªå®šä¹‰å¤„ç†å™¨
  - SIGKILL å’Œ SIGSTOP ä¸å¯æ•è·/å¿½ç•¥
  - ä¿¡å·ä½å›¾å’Œå±è”½ä½å›¾

---

### 3. å†…å­˜ç®¡ç†æ¨¡å— (mm/)

#### MemoryManager.java - å†…å­˜ç®¡ç†å™¨
- **åŠŸèƒ½**ï¼šå†…å­˜ç®¡ç†åè°ƒå™¨
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `mm/memory.c`
- **èŒè´£**ï¼š
  - åè°ƒç‰©ç†å†…å­˜å’Œè™šæ‹Ÿå†…å­˜
  - åˆ›å»ºå’Œç®¡ç†åœ°å€ç©ºé—´
  - é¡µé¢åˆ†é…å’Œé‡Šæ”¾

#### PhysicalMemory.java - ç‰©ç†å†…å­˜ç®¡ç†
- **åŠŸèƒ½**ï¼šç‰©ç†å†…å­˜åˆ†é…å’Œç®¡ç†
- **å¯¹åº”**ï¼šLinux 0.01 çš„ç‰©ç†å†…å­˜ç®¡ç†
- **å®ç°**ï¼š
  - 16MB ç‰©ç†å†…å­˜æ¨¡æ‹Ÿ
  - ä½å›¾æ–¹å¼ç®¡ç†é¡µé¢ï¼ˆ3840 é¡µï¼‰
  - é¡µé¢å¼•ç”¨è®¡æ•°ï¼ˆç”¨äº COWï¼‰
- **æ ¸å¿ƒæ–¹æ³•**ï¼š
  - `allocPage()` - åˆ†é…ç‰©ç†é¡µ
  - `freePage()` - é‡Šæ”¾ç‰©ç†é¡µ
  - `incrementPageRef()` - å¢åŠ å¼•ç”¨è®¡æ•°ï¼ˆCOWï¼‰

#### AddressSpace.java - åœ°å€ç©ºé—´
- **åŠŸèƒ½**ï¼šè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ç®¡ç†
- **å¯¹åº”**ï¼šLinux 0.01 çš„è¿›ç¨‹åœ°å€ç©ºé—´
- **å®ç°**ï¼š
  - æ¯ä¸ªè¿›ç¨‹ç‹¬ç«‹çš„ 64MB è™šæ‹Ÿç©ºé—´
  - é¡µè¡¨æ˜ å°„ï¼ˆè™šæ‹Ÿé¡µ â†’ ç‰©ç†é¡µï¼‰
  - æ®µç®¡ç†ï¼ˆä»£ç æ®µã€æ•°æ®æ®µã€å †ã€æ ˆï¼‰
  - **å†™æ—¶å¤åˆ¶ï¼ˆCOWï¼‰**ï¼šfork æ—¶å…±äº«é¡µé¢ï¼Œå†™æ—¶æ‰å¤åˆ¶
- **æ ¸å¿ƒæ–¹æ³•**ï¼š
  - `allocateAndMap()` - åˆ†é…å¹¶æ˜ å°„è™šæ‹Ÿé¡µ
  - `expandBrk()` - æ‰©å±•å †ï¼ˆbrk ç³»ç»Ÿè°ƒç”¨ï¼‰
  - `copy()` - å¤åˆ¶åœ°å€ç©ºé—´ï¼ˆCOW ä¼˜åŒ–ï¼‰
  - `handleCopyOnWrite()` - å¤„ç†å†™æ—¶å¤åˆ¶

#### PageTable.java - é¡µè¡¨
- **åŠŸèƒ½**ï¼šè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„
- **å¯¹åº”**ï¼šLinux 0.01 çš„é¡µè¡¨æœºåˆ¶
- **å®ç°**ï¼š
  - ä½¿ç”¨ HashMap å­˜å‚¨æ˜ å°„å…³ç³»ï¼ˆç®€åŒ–å®ç°ï¼‰
  - é¡µé¢æƒé™æ ‡å¿—ï¼ˆPAGE_PRESENT, PAGE_RW, PAGE_USER, PAGE_COWï¼‰
  - åœ°å€è½¬æ¢

---

### 4. æ–‡ä»¶ç³»ç»Ÿæ¨¡å— (fs/)

#### VirtualFileSystem.java - è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ
- **åŠŸèƒ½**ï¼šæ–‡ä»¶ç³»ç»ŸæŠ½è±¡å±‚
- **å¯¹åº”**ï¼šLinux 0.01 çš„ VFS å±‚
- **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - **è·¯å¾„è§£æ**ï¼š`namei()` - è·¯å¾„å â†’ inode
  - **ç›®å½•æŸ¥æ‰¾**ï¼š`lookup()` - åœ¨ç›®å½•ä¸­æŸ¥æ‰¾æ–‡ä»¶
  - **æ–‡ä»¶åˆ›å»º**ï¼š`createFile()` - åˆ›å»ºæ–°æ–‡ä»¶
  - **ç›®å½•åˆ›å»º**ï¼š`createDirectory()` - åˆ›å»ºç›®å½•
  - **æ–‡ä»¶åˆ é™¤**ï¼š`unlink()` - åˆ é™¤æ–‡ä»¶/ç›®å½•
  - **æ–‡ä»¶è¯»å†™**ï¼š`readFileData()` / `writeFileData()` - ä»ç£ç›˜è¯»å†™
  - **æ•°æ®å—ç®¡ç†**ï¼š`allocateBlock()` / `freeBlock()`
- **æ•°æ®ç»“æ„**ï¼š
  - `superBlocks` - è¶…çº§å—è¡¨
  - `inodeCache` - Inode ç¼“å­˜
  - `bufferCache` - ç¼“å†²åŒºç¼“å­˜

#### Inode.java - ç´¢å¼•èŠ‚ç‚¹
- **åŠŸèƒ½**ï¼šæ–‡ä»¶/ç›®å½•çš„å…ƒæ•°æ®
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `include/linux/fs.h` ä¸­çš„ `inode`
- **æ ¸å¿ƒå­—æ®µ**ï¼š
  ```java
  - ino, dev           // inode å·å’Œè®¾å¤‡å·
  - mode               // æ–‡ä»¶ç±»å‹å’Œæƒé™
  - size               // æ–‡ä»¶å¤§å°
  - directBlocks[10]   // ç›´æ¥å—æŒ‡é’ˆï¼ˆ10ä¸ªï¼‰
  - indirectBlock      // ä¸€çº§é—´æ¥å—æŒ‡é’ˆ
  - doubleIndirectBlock // äºŒçº§é—´æ¥å—æŒ‡é’ˆ
  - atime, mtime, ctime // è®¿é—®ã€ä¿®æ”¹ã€åˆ›å»ºæ—¶é—´
  ```

#### SuperBlock.java - è¶…çº§å—
- **åŠŸèƒ½**ï¼šæ–‡ä»¶ç³»ç»Ÿå…ƒæ•°æ®ç®¡ç†
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `include/linux/fs.h` ä¸­çš„ `super_block`
- **ç®¡ç†å†…å®¹**ï¼š
  - Inode æ€»æ•°å’Œæ•°æ®å—æ€»æ•°
  - Inode ä½å›¾å’Œæ•°æ®å—ä½å›¾
  - Inode åˆ†é…å’Œé‡Šæ”¾
  - æ•°æ®å—åˆ†é…å’Œé‡Šæ”¾

#### BufferCache.java - ç¼“å†²åŒºç¼“å­˜
- **åŠŸèƒ½**ï¼šå—è®¾å¤‡ç¼“å†²åŒºç¼“å­˜
- **å¯¹åº”**ï¼šLinux 0.01 çš„ç¼“å†²åŒºç¼“å­˜
- **å®ç°**ï¼š
  - LRU ç¼“å­˜ç­–ç•¥
  - è„å—ç®¡ç†
  - ç¼“å†²åŒºåŒæ­¥

#### File.java - æ–‡ä»¶å¯¹è±¡
- **åŠŸèƒ½**ï¼šæ‰“å¼€æ–‡ä»¶çš„å†…å­˜è¡¨ç¤º
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `include/linux/fs.h` ä¸­çš„ `file`
- **æ ¸å¿ƒå­—æ®µ**ï¼š
  - `inode` - å¯¹åº”çš„ inode
  - `position` - æ–‡ä»¶ä½ç½®æŒ‡é’ˆ
  - `mode` - æ‰“å¼€æ¨¡å¼ï¼ˆO_RDONLY, O_WRONLY, O_RDWR, etc.ï¼‰
  - `refCount` - å¼•ç”¨è®¡æ•°

#### FileDescriptorTable.java - æ–‡ä»¶æè¿°ç¬¦è¡¨
- **åŠŸèƒ½**ï¼šè¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦ç®¡ç†
- **å¯¹åº”**ï¼šLinux 0.01 çš„è¿›ç¨‹æ–‡ä»¶æè¿°ç¬¦æ•°ç»„
- **å®ç°**ï¼š
  - æ–‡ä»¶æè¿°ç¬¦æ•°ç»„ï¼ˆæœ€å¤š NR_OPEN ä¸ªï¼‰
  - æ–‡ä»¶æè¿°ç¬¦åˆ†é…å’Œé‡Šæ”¾
  - æ”¯æŒ dup/dup2

---

### 5. è®¾å¤‡é©±åŠ¨æ¨¡å— (drivers/)

#### Device.java - è®¾å¤‡æŠ½è±¡åŸºç±»
- **åŠŸèƒ½**ï¼šè®¾å¤‡æŠ½è±¡æ¥å£
- **å¯¹åº”**ï¼šLinux 0.01 çš„è®¾å¤‡æŠ½è±¡

#### ConsoleDevice.java - æ§åˆ¶å°è®¾å¤‡
- **åŠŸèƒ½**ï¼šæ ‡å‡†è¾“å…¥è¾“å‡º
- **å®ç°**ï¼šä½¿ç”¨ System.in/out æ¨¡æ‹Ÿæ§åˆ¶å°

#### VirtualDiskDevice.java - è™šæ‹Ÿç£ç›˜è®¾å¤‡
- **åŠŸèƒ½**ï¼šå—è®¾å¤‡æ¨¡æ‹Ÿ
- **å®ç°**ï¼š
  - 10MB è™šæ‹Ÿç£ç›˜ï¼ˆæ–‡ä»¶æ¨¡æ‹Ÿï¼‰
  - å—å¤§å°ï¼š4KB
  - æ”¯æŒå—è¯»å†™æ“ä½œ

#### ClockDevice.java - æ—¶é’Ÿè®¾å¤‡
- **åŠŸèƒ½**ï¼šå®šæ—¶å™¨ä¸­æ–­
- **å®ç°**ï¼š
  - 100 HZ é¢‘ç‡ï¼ˆæ¯ 10ms è§¦å‘ä¸€æ¬¡ï¼‰
  - è§¦å‘è¿›ç¨‹è°ƒåº¦
  - ä½¿ç”¨ Java Timer æ¨¡æ‹Ÿ

---

### 6. è¿›ç¨‹é—´é€šä¿¡æ¨¡å— (ipc/)

#### Pipe.java - ç®¡é“
- **åŠŸèƒ½**ï¼šè¿›ç¨‹é—´é€šä¿¡ç®¡é“
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `fs/pipe.c`
- **å®ç°**ï¼š
  - 4KB å¾ªç¯ç¼“å†²åŒº
  - é˜»å¡å¼è¯»å†™
  - è¯»ç«¯/å†™ç«¯å¼•ç”¨è®¡æ•°
  - EOF æ£€æµ‹å’Œ SIGPIPE ä¿¡å·

#### PipeFile.java - ç®¡é“æ–‡ä»¶å°è£…
- **åŠŸèƒ½**ï¼šå°†ç®¡é“å°è£…ä¸ºæ–‡ä»¶å¯¹è±¡
- **å®ç°**ï¼šå®ç° File æ¥å£ï¼Œç”¨äºæ–‡ä»¶æè¿°ç¬¦è¡¨

---

### 7. ç¨‹åºæ‰§è¡Œæ¨¡å— (exec/)

#### ProgramLoader.java - ç¨‹åºåŠ è½½å™¨
- **åŠŸèƒ½**ï¼šåŠ è½½å’Œæ‰§è¡Œç¨‹åº
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `fs/exec.c`
- **å®ç°**ï¼š
  - ç¨‹åºæ³¨å†Œæœºåˆ¶
  - ç¨‹åºåŠ è½½å’Œæ‰§è¡Œ
  - æ”¯æŒé¢„æ³¨å†Œç¨‹åºï¼ˆhello, echo, loop, fork_testï¼‰

---

### 8. Shell æ¨¡å— (shell/)

#### SimpleShell.java - Shell å‘½ä»¤è§£é‡Šå™¨
- **åŠŸèƒ½**ï¼šäº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢
- **ç‰¹æ€§**ï¼š
  - äº¤äº’å¼å‘½ä»¤è¡Œæç¤ºç¬¦
  - å†…ç½®å‘½ä»¤æ”¯æŒï¼ˆ12+ å‘½ä»¤ï¼‰
  - **å‘½ä»¤ç®¡é“ `|`** - æ”¯æŒå¤šå‘½ä»¤è¿æ¥
  - **æ–‡ä»¶é‡å®šå‘ `>`, `>>`, `<`** - è¾“å…¥è¾“å‡ºé‡å®šå‘
  - **åå°æ‰§è¡Œ `&`** - åå°ä»»åŠ¡æ”¯æŒ
- **å†…ç½®å‘½ä»¤**ï¼š
  - help, ps, mem, time, signal, kill
  - demo, echo, clear, uptime, version, exit

---

### 9. ç”¨æˆ·æ€åº“æ¨¡å— (lib/)

#### LibC.java - C åº“å°è£…
- **åŠŸèƒ½**ï¼šç³»ç»Ÿè°ƒç”¨çš„é«˜çº§å°è£…
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `lib/` ç›®å½•
- **å°è£…å‡½æ•°**ï¼ˆ35+ ä¸ªï¼‰ï¼š
  - è¿›ç¨‹ç®¡ç†ï¼šgetpid, fork, exit, waitpid, pause
  - æ–‡ä»¶ I/Oï¼šopen, close, read, write, lseek, creat, unlink
  - ç›®å½•æ“ä½œï¼šchdir, mkdir, rmdir
  - ä¿¡å·å¤„ç†ï¼šsignal, kill
  - IPCï¼špipe
  - å†…å­˜ç®¡ç†ï¼šbrk, malloc
  - æ—¶é—´ï¼štime
  - å…¶ä»–ï¼šsync, print, println

---

### 10. å…¬å…±å®šä¹‰æ¨¡å— (include/)

#### Const.java - ç³»ç»Ÿå¸¸é‡
- **åŠŸèƒ½**ï¼šç³»ç»Ÿå¸¸é‡å®šä¹‰
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `include/linux/` ä¸­çš„å¸¸é‡å®šä¹‰
- **å®šä¹‰å†…å®¹**ï¼š
  - è¿›ç¨‹æ•°é™åˆ¶ï¼ˆNR_TASKS = 64ï¼‰
  - å†…å­˜å¤§å°ï¼ˆ16MB ç‰©ç†å†…å­˜ï¼‰
  - é¡µé¢å¤§å°ï¼ˆ4KBï¼‰
  - æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ï¼ˆNR_OPENï¼‰
  - é”™è¯¯ç ï¼ˆEINVAL, ENOENT, etc.ï¼‰

#### Types.java - ç±»å‹å®šä¹‰
- **åŠŸèƒ½**ï¼šç³»ç»Ÿç±»å‹å®šä¹‰
- **å¯¹åº”**ï¼šLinux 0.01 çš„ç±»å‹å®šä¹‰
- **å®šä¹‰ç±»å‹**ï¼š
  - `DeviceId` - è®¾å¤‡å·ç±»å‹
  - `InodeNum` - inode å·ç±»å‹
  - `TimeT` - æ—¶é—´ç±»å‹
  - `Stat` - æ–‡ä»¶çŠ¶æ€ç»“æ„ä½“
  - `Tms` - è¿›ç¨‹æ—¶é—´ç»“æ„ä½“

#### Syscalls.java - ç³»ç»Ÿè°ƒç”¨å·
- **åŠŸèƒ½**ï¼šç³»ç»Ÿè°ƒç”¨å·å®šä¹‰
- **å¯¹åº”**ï¼šLinux 0.01 çš„ `include/unistd.h`
- **å®šä¹‰**ï¼š28 ä¸ªç³»ç»Ÿè°ƒç”¨å·

---

## æ•°æ®æµå’Œæ§åˆ¶æµ

### ç³»ç»Ÿå¯åŠ¨æµç¨‹

```
1. Bootstrap.main()
   â†“
2. Kernel() - åˆ›å»ºå†…æ ¸å®ä¾‹
   â†“
3. kernel.init() - åˆå§‹åŒ–å­ç³»ç»Ÿ
   â”œâ”€ MemoryManager åˆå§‹åŒ–
   â”œâ”€ Scheduler åˆå§‹åŒ–
   â”œâ”€ SystemCallDispatcher åˆå§‹åŒ–
   â”œâ”€ è®¾å¤‡åˆå§‹åŒ–ï¼ˆConsole, Disk, Clockï¼‰
   â””â”€ VFS åˆå§‹åŒ–
   â†“
4. kernel.createInitProcess() - åˆ›å»º init è¿›ç¨‹
   â”œâ”€ åˆ†é… PID
   â”œâ”€ åˆ›å»ºåœ°å€ç©ºé—´
   â”œâ”€ åˆ†é…åˆå§‹å†…å­˜é¡µé¢
   â””â”€ è®¾ç½®å¯æ‰§è¡Œä»£ç 
   â†“
5. kernel.start() - å¯åŠ¨ç³»ç»Ÿ
   â”œâ”€ å¯åŠ¨æ—¶é’Ÿè®¾å¤‡
   â”œâ”€ å¼€å§‹è¿›ç¨‹è°ƒåº¦
   â””â”€ è¿è¡Œ init è¿›ç¨‹
```

### ç³»ç»Ÿè°ƒç”¨æµç¨‹

```
ç”¨æˆ·ç¨‹åºè°ƒç”¨ LibC å‡½æ•°
   â†“
LibC å°è£…ç³»ç»Ÿè°ƒç”¨
   â†“
SystemCallDispatcher.dispatch()
   â”œâ”€ ä»ç”¨æˆ·ç©ºé—´è¯»å–å‚æ•°
   â”œâ”€ è°ƒç”¨ç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•°
   â”œâ”€ å¤„ç†ç”¨æˆ·ç©ºé—´æ•°æ®æ‹·è´
   â””â”€ è¿”å›ç»“æœ
   â†“
ç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•°
   â”œâ”€ å‚æ•°éªŒè¯
   â”œâ”€ è°ƒç”¨ç›¸åº”çš„å†…æ ¸æ¨¡å—
   â””â”€ è¿”å›ç»“æœ
```

### è¿›ç¨‹åˆ›å»ºæµç¨‹ï¼ˆforkï¼‰

```
1. ç”¨æˆ·ç¨‹åºè°ƒç”¨ fork()
   â†“
2. sysFork() ç³»ç»Ÿè°ƒç”¨
   â”œâ”€ åˆ†é…æ–° PID
   â”œâ”€ å¤åˆ¶åœ°å€ç©ºé—´ï¼ˆCOWï¼‰
   â”‚   â”œâ”€ å…±äº«ç‰©ç†é¡µé¢
   â”‚   â”œâ”€ æ ‡è®°ä¸ºåªè¯»å’Œ COW
   â”‚   â””â”€ å¢åŠ é¡µé¢å¼•ç”¨è®¡æ•°
   â”œâ”€ å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦è¡¨
   â”œâ”€ åˆ›å»ºå­è¿›ç¨‹ Task
   â””â”€ æ·»åŠ åˆ°è°ƒåº¦å™¨
   â†“
3. è¿”å›å­è¿›ç¨‹ PIDï¼ˆçˆ¶è¿›ç¨‹ï¼‰æˆ– 0ï¼ˆå­è¿›ç¨‹ï¼‰
```

### æ–‡ä»¶æ“ä½œæµç¨‹

```
1. ç”¨æˆ·ç¨‹åºè°ƒç”¨ open(path)
   â†“
2. sysOpen() ç³»ç»Ÿè°ƒç”¨
   â”œâ”€ ä»ç”¨æˆ·ç©ºé—´è¯»å–è·¯å¾„å
   â”œâ”€ VFS.namei() - è·¯å¾„è§£æ
   â”‚   â”œâ”€ è§£æè·¯å¾„ç»„ä»¶
   â”‚   â”œâ”€ æŸ¥æ‰¾ç›®å½•é¡¹
   â”‚   â””â”€ è¿”å› inode
   â”œâ”€ å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ä¸” O_CREATï¼Œåˆ›å»ºæ–‡ä»¶
   â”œâ”€ åˆ›å»º File å¯¹è±¡
   â””â”€ åˆ†é…æ–‡ä»¶æè¿°ç¬¦
   â†“
3. è¿”å›æ–‡ä»¶æè¿°ç¬¦
```

### å†…å­˜åˆ†é…æµç¨‹ï¼ˆCOWï¼‰

```
1. fork() æ—¶å¤åˆ¶åœ°å€ç©ºé—´
   â”œâ”€ AddressSpace.copy()
   â”œâ”€ å…±äº«ç‰©ç†é¡µé¢
   â””â”€ æ ‡è®°ä¸º COW å’Œåªè¯»
   â†“
2. å­è¿›ç¨‹å†™å…¥å…±äº«é¡µé¢
   â”œâ”€ writeByte() æ£€æµ‹åˆ° COW æ ‡è®°
   â”œâ”€ handleCopyOnWrite()
   â”‚   â”œâ”€ æ£€æŸ¥å¼•ç”¨è®¡æ•°
   â”‚   â”œâ”€ å¦‚æœ > 1ï¼šå¤åˆ¶é¡µé¢
   â”‚   â””â”€ å¦‚æœ = 1ï¼šç›´æ¥ä¿®æ”¹
   â””â”€ æ›´æ–°é¡µè¡¨æ˜ å°„
```

---

## å…³é”®è®¾è®¡å†³ç­–

### 1. é¢å‘å¯¹è±¡è®¾è®¡

**å†³ç­–**ï¼šä½¿ç”¨ Java é¢å‘å¯¹è±¡ç‰¹æ€§ç»„ç»‡ä»£ç 

**ä¼˜åŠ¿**ï¼š
- æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†
- æ˜“äºç†è§£å’Œç»´æŠ¤
- ç±»å‹å®‰å…¨

**ç¤ºä¾‹**ï¼š
- `Task` ç±»å°è£…è¿›ç¨‹æ‰€æœ‰çŠ¶æ€
- `AddressSpace` ç±»å°è£…åœ°å€ç©ºé—´
- `Inode` ç±»å°è£…æ–‡ä»¶å…ƒæ•°æ®

### 2. ç®€åŒ–å®ç°ç­–ç•¥

**å†³ç­–**ï¼šåœ¨ä¿æŒæ ¸å¿ƒæ¦‚å¿µçš„å‰æä¸‹ç®€åŒ–å®ç°

**ç¤ºä¾‹**ï¼š
- é¡µè¡¨ä½¿ç”¨ HashMap è€ŒéçœŸå®é¡µè¡¨ç»“æ„
- ä½¿ç”¨ Java çº¿ç¨‹æ¨¡æ‹Ÿè¿›ç¨‹
- ä½¿ç”¨ Timer æ¨¡æ‹Ÿæ—¶é’Ÿä¸­æ–­

**åŸå› **ï¼š
- æ•™å­¦ç›®çš„ï¼Œé‡ç‚¹åœ¨æ¦‚å¿µè€Œéåº•å±‚ç»†èŠ‚
- Java å¹³å°é™åˆ¶ï¼Œæ— æ³•å®ç°çœŸå®ç¡¬ä»¶æ§åˆ¶

### 3. å†™æ—¶å¤åˆ¶ï¼ˆCOWï¼‰ä¼˜åŒ–

**å†³ç­–**ï¼šå®ç° COW ä»¥ä¼˜åŒ– fork æ€§èƒ½

**å®ç°**ï¼š
- fork æ—¶å…±äº«ç‰©ç†é¡µé¢
- é¡µé¢æ ‡è®°ä¸ºåªè¯»å’Œ COW
- å†™å…¥æ—¶æ£€æŸ¥å¼•ç”¨è®¡æ•°å¹¶å¤åˆ¶

**æ•ˆæœ**ï¼š
- fork æ“ä½œä» O(n) å˜ä¸º O(1)
- å†…å­˜ä½¿ç”¨å¤§å¹…å‡å°‘

### 4. ç”¨æˆ·ç©ºé—´æ•°æ®æ‹·è´

**å†³ç­–**ï¼šå®ç°å®Œæ•´çš„ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´æ•°æ®æ‹·è´

**å®ç°**ï¼š
- `copyFromUser()` - ä»ç”¨æˆ·ç©ºé—´è¯»å–
- `copyToUser()` - å‘ç”¨æˆ·ç©ºé—´å†™å…¥
- `copyStringFromUser()` - è¯»å–å­—ç¬¦ä¸²
- `readStringArrayFromUser()` - è¯»å–å­—ç¬¦ä¸²æ•°ç»„

**é‡è¦æ€§**ï¼š
- ç³»ç»Ÿè°ƒç”¨æ­£ç¡®æ€§çš„åŸºç¡€
- æ”¯æŒå¤æ‚çš„å‚æ•°ä¼ é€’

### 5. æ¨¡å—åŒ–è®¾è®¡

**å†³ç­–**ï¼šæ¸…æ™°çš„æ¨¡å—åˆ’åˆ†å’Œæ¥å£å®šä¹‰

**æ¨¡å—åˆ’åˆ†**ï¼š
- `kernel/` - å†…æ ¸æ ¸å¿ƒ
- `mm/` - å†…å­˜ç®¡ç†
- `fs/` - æ–‡ä»¶ç³»ç»Ÿ
- `drivers/` - è®¾å¤‡é©±åŠ¨
- `ipc/` - è¿›ç¨‹é—´é€šä¿¡
- `lib/` - ç”¨æˆ·æ€åº“

**ä¼˜åŠ¿**ï¼š
- æ˜“äºç†è§£å’Œç»´æŠ¤
- ä¾¿äºæ‰©å±•æ–°åŠŸèƒ½
- æ¨¡å—é—´ä½è€¦åˆ

---

## ä¸ Linux 0.01 çš„å¯¹åº”å…³ç³»

| Linux 0.01 | Jinux | è¯´æ˜ |
|-----------|-------|------|
| `boot/bootsect.s` | `boot/Bootstrap.java` | å¯åŠ¨å¼•å¯¼ |
| `kernel/main.c` | `kernel/Kernel.java` | å†…æ ¸ä¸»å‡½æ•° |
| `kernel/sched.c` | `kernel/Scheduler.java` | è¿›ç¨‹è°ƒåº¦ |
| `kernel/signal.c` | `kernel/Signal.java` | ä¿¡å·æœºåˆ¶ |
| `kernel/system_call.s` | `kernel/SystemCallDispatcher.java` | ç³»ç»Ÿè°ƒç”¨ |
| `include/linux/sched.h` | `kernel/Task.java` | è¿›ç¨‹æ§åˆ¶å— |
| `mm/memory.c` | `mm/MemoryManager.java` | å†…å­˜ç®¡ç† |
| `mm/` | `mm/PhysicalMemory.java`, `mm/AddressSpace.java`, `mm/PageTable.java` | å†…å­˜ç®¡ç†å­ç³»ç»Ÿ |
| `fs/` | `fs/VirtualFileSystem.java`, `fs/Inode.java`, `fs/SuperBlock.java` | æ–‡ä»¶ç³»ç»Ÿ |
| `fs/pipe.c` | `ipc/Pipe.java` | ç®¡é“ IPC |
| `fs/exec.c` | `exec/ProgramLoader.java` | ç¨‹åºåŠ è½½ |
| `lib/` | `lib/LibC.java` | ç”¨æˆ·æ€åº“ |
| `include/linux/*.h` | `include/Const.java`, `include/Types.java`, `include/Syscalls.java` | å…¬å…±å®šä¹‰ |

---

## æ¨¡å—ä¾èµ–å…³ç³»

### ä¾èµ–å…³ç³»å›¾

```
Bootstrap
  â””â”€ Kernel
      â”œâ”€ MemoryManager
      â”‚   â”œâ”€ PhysicalMemory
      â”‚   â””â”€ AddressSpace
      â”‚       â””â”€ PageTable
      â”œâ”€ Scheduler
      â”‚   â””â”€ Task
      â”‚       â”œâ”€ AddressSpace
      â”‚       â”œâ”€ FileDescriptorTable
      â”‚       â”‚   â””â”€ File
      â”‚       â”‚       â””â”€ Inode
      â”‚       â””â”€ Signal (ä¿¡å·å¤„ç†å™¨)
      â”œâ”€ SystemCallDispatcher
      â”‚   â”œâ”€ Scheduler
      â”‚   â”œâ”€ MemoryManager
      â”‚   â”œâ”€ VirtualFileSystem
      â”‚   â”‚   â”œâ”€ SuperBlock
      â”‚   â”‚   â”œâ”€ Inode
      â”‚   â”‚   â””â”€ BufferCache
      â”‚   â””â”€ ProgramLoader
      â”œâ”€ VirtualFileSystem
      â”‚   â””â”€ VirtualDiskDevice
      â”œâ”€ ConsoleDevice
      â”œâ”€ VirtualDiskDevice
      â””â”€ ClockDevice
          â””â”€ Scheduler
```

### æ¨¡å—é—´é€šä¿¡

1. **ç”¨æˆ·æ€ â†’ å†…æ ¸æ€**ï¼šé€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥å£
2. **å†…æ ¸æ¨¡å—é—´**ï¼šç›´æ¥æ–¹æ³•è°ƒç”¨
3. **è®¾å¤‡é©±åŠ¨ â†’ å†…æ ¸**ï¼šé€šè¿‡è®¾å¤‡æ¥å£
4. **æ—¶é’Ÿä¸­æ–­ â†’ è°ƒåº¦å™¨**ï¼šè§¦å‘è¿›ç¨‹è°ƒåº¦

---

## å…³é”®æ•°æ®ç»“æ„

### Taskï¼ˆè¿›ç¨‹æ§åˆ¶å—ï¼‰
```java
class Task {
    int pid, ppid;
    int state;
    int counter, priority;
    AddressSpace addressSpace;
    FileDescriptorTable fdTable;
    long signalPending;
    long signalBlocked;
    SignalHandlerEntry[] signalHandlers;
    long utime, stime;
    // ...
}
```

### AddressSpaceï¼ˆåœ°å€ç©ºé—´ï¼‰
```java
class AddressSpace {
    PageTable pageTable;
    long codeStart, codeEnd;
    long dataStart, dataEnd;
    long brk;
    long stackTop;
    // ...
}
```

### Inodeï¼ˆç´¢å¼•èŠ‚ç‚¹ï¼‰
```java
class Inode {
    int ino, dev;
    int mode;
    long size;
    int[] directBlocks;  // 10ä¸ªç›´æ¥å—
    int indirectBlock;
    int doubleIndirectBlock;
    long atime, mtime, ctime;
    // ...
}
```

---

## ç³»ç»Ÿè°ƒç”¨æ¥å£

### ç³»ç»Ÿè°ƒç”¨åˆ†å‘æœºåˆ¶

```java
// ç”¨æˆ·ç¨‹åºè°ƒç”¨
long result = syscallDispatcher.dispatch(syscallNr, arg1, arg2, arg3);

// åˆ†å‘å™¨å¤„ç†
1. è·å–å½“å‰è¿›ç¨‹
2. æŸ¥æ‰¾ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨
3. ä»ç”¨æˆ·ç©ºé—´è¯»å–å‚æ•°ï¼ˆå¦‚éœ€è¦ï¼‰
4. è°ƒç”¨å¤„ç†å‡½æ•°
5. å°†ç»“æœå†™å›ç”¨æˆ·ç©ºé—´ï¼ˆå¦‚éœ€è¦ï¼‰
6. è¿”å›ç»“æœ
```

### ç³»ç»Ÿè°ƒç”¨åˆ†ç±»

1. **è¿›ç¨‹ç®¡ç†**ï¼ˆ7ä¸ªï¼‰ï¼šfork, exit, wait, getpid, getppid, pause, execve
2. **ä¿¡å·ç®¡ç†**ï¼ˆ2ä¸ªï¼‰ï¼šsignal, kill
3. **æ–‡ä»¶æ“ä½œ**ï¼ˆ7ä¸ªï¼‰ï¼šread, write, open, close, lseek, creat, unlink
4. **ç›®å½•æ“ä½œ**ï¼ˆ3ä¸ªï¼‰ï¼šchdir, mkdir, rmdir
5. **æ–‡ä»¶çŠ¶æ€**ï¼ˆ2ä¸ªï¼‰ï¼šstat, fstat
6. **å†…å­˜ç®¡ç†**ï¼ˆ1ä¸ªï¼‰ï¼šbrk
7. **æ—¶é—´**ï¼ˆ2ä¸ªï¼‰ï¼štime, times
8. **IPC**ï¼ˆ1ä¸ªï¼‰ï¼špipe
9. **æ–‡ä»¶æè¿°ç¬¦**ï¼ˆ2ä¸ªï¼‰ï¼šdup, dup2
10. **æ–‡ä»¶ç³»ç»Ÿ**ï¼ˆ1ä¸ªï¼‰ï¼šsync

**æ€»è®¡ï¼š28 ä¸ªç³»ç»Ÿè°ƒç”¨**

---

## å†…å­˜å¸ƒå±€

### è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆ64MBï¼‰

```
0x00000000 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   ä»£ç æ®µ         â”‚
           â”‚   (Code)         â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚   æ•°æ®æ®µ         â”‚
           â”‚   (Data)         â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚   å † (Heap)      â”‚ â† brk
           â”‚   (å¯æ‰©å±•)       â”‚
           â”‚                 â”‚
           â”‚   ...           â”‚
           â”‚                 â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚   æ ˆ (Stack)     â”‚ â† stackTop
           â”‚   (å‘ä¸‹å¢é•¿)     â”‚
0x04000000 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç‰©ç†å†…å­˜å¸ƒå±€ï¼ˆ16MBï¼‰

```
0x00000000 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   å†…æ ¸ä»£ç        â”‚
           â”‚   (ä¿ç•™)         â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
           â”‚   ç”¨æˆ·è¿›ç¨‹å†…å­˜   â”‚
           â”‚   (3840 é¡µ)      â”‚
           â”‚   ä½å›¾ç®¡ç†       â”‚
0x01000000 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€

### MINIX æ–‡ä»¶ç³»ç»Ÿå¸ƒå±€

```
å— 0:  è¶…çº§å—
å— 1:  ä¿ç•™
å— 2-N: Inode ä½å›¾
å— N-M: æ•°æ®å—ä½å›¾
å— M-K: Inode è¡¨
å— K+:  æ•°æ®åŒº
```

### ç›®å½•é¡¹æ ¼å¼ï¼ˆ16 å­—èŠ‚ï¼‰

```
+0:  inode å· (2 å­—èŠ‚)
+2:  æ–‡ä»¶å (14 å­—èŠ‚ï¼Œä»¥ 0 ç»“å°¾)
```

---

## è¿›ç¨‹çŠ¶æ€è½¬æ¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RUNNING â”‚ â†â”€â”€â”
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚
     â”‚        â”‚
     â”‚ exit() â”‚
     â†“        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ ZOMBIE  â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
              â”‚
     â”‚ wait() â”‚
     â†“        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ å›æ”¶    â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
              â”‚
     â”‚ sleep()â”‚
     â†“        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚INTERRUPTâ”‚   â”‚
â”‚IBLE     â”‚   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚
     â”‚        â”‚
     â”‚wakeUp()â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¿¡å·å¤„ç†æµç¨‹

```
1. è¿›ç¨‹ A è°ƒç”¨ kill(pid, SIGINT)
   â†“
2. sysKill() ç³»ç»Ÿè°ƒç”¨
   â”œâ”€ æŸ¥æ‰¾ç›®æ ‡è¿›ç¨‹
   â””â”€ å‘é€ä¿¡å·ï¼ˆè®¾ç½®ä¿¡å·ä½å›¾ï¼‰
   â†“
3. è°ƒåº¦å™¨æ£€æŸ¥å¾…å¤„ç†ä¿¡å·
   â†“
4. å¤„ç†ä¿¡å·
   â”œâ”€ æ£€æŸ¥ä¿¡å·å¤„ç†å™¨
   â”œâ”€ SIG_IGN: å¿½ç•¥
   â”œâ”€ SIG_DFL: é»˜è®¤è¡Œä¸ºï¼ˆç»ˆæ­¢/åœæ­¢ç­‰ï¼‰
   â””â”€ è‡ªå®šä¹‰å¤„ç†å™¨: æ‰§è¡Œç”¨æˆ·ä»£ç 
```

---

## æ€§èƒ½ç‰¹æ€§

### å†™æ—¶å¤åˆ¶ï¼ˆCOWï¼‰ä¼˜åŒ–

**æ•ˆæœ**ï¼š
- fork æ“ä½œï¼šä»å®Œæ•´å¤åˆ¶å˜ä¸ºå…±äº«é¡µé¢
- å†…å­˜ä½¿ç”¨ï¼šå¤§å¹…å‡å°‘ï¼ˆå¤šä¸ªè¿›ç¨‹å…±äº«åªè¯»é¡µé¢ï¼‰
- æ€§èƒ½æå‡ï¼šfork æ—¶é—´ä» O(n) å˜ä¸º O(1)

**å®ç°ç»†èŠ‚**ï¼š
- é¡µé¢å¼•ç”¨è®¡æ•°ç®¡ç†
- å†™ä¿æŠ¤æœºåˆ¶
- æŒ‰éœ€å¤åˆ¶

### ç¼“å­˜æœºåˆ¶

**Inode ç¼“å­˜**ï¼š
- ç¼“å­˜æœ€è¿‘è®¿é—®çš„ inode
- å‡å°‘ç£ç›˜ I/O

**ç¼“å†²åŒºç¼“å­˜**ï¼š
- LRU ç­–ç•¥
- è„å—å»¶è¿Ÿå†™å›

---

## æ‰©å±•æ€§è®¾è®¡

### æ·»åŠ æ–°ç³»ç»Ÿè°ƒç”¨

1. åœ¨ `Syscalls.java` ä¸­å®šä¹‰ç³»ç»Ÿè°ƒç”¨å·
2. åœ¨ `SystemCallDispatcher.java` ä¸­æ³¨å†Œå¤„ç†å™¨
3. å®ç°ç³»ç»Ÿè°ƒç”¨å¤„ç†å‡½æ•°
4. åœ¨ `LibC.java` ä¸­æ·»åŠ ç”¨æˆ·æ€å°è£…

### æ·»åŠ æ–°è®¾å¤‡é©±åŠ¨

1. ç»§æ‰¿ `Device` æˆ– `CharDevice`/`BlockDevice`
2. å®ç°è®¾å¤‡æ¥å£æ–¹æ³•
3. åœ¨ `Kernel.java` ä¸­åˆå§‹åŒ–å’Œæ³¨å†Œ

### æ·»åŠ æ–°æ–‡ä»¶ç³»ç»Ÿæ“ä½œ

1. åœ¨ `VirtualFileSystem.java` ä¸­æ·»åŠ æ–¹æ³•
2. åœ¨ç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨ä¸­è°ƒç”¨
3. æ›´æ–°é”™è¯¯å¤„ç†

---

## é™åˆ¶å’Œçº¦æŸ

### Java å®ç°çš„é™åˆ¶

1. **ä¸æ˜¯çœŸå®å†…æ ¸**ï¼šè¿è¡Œåœ¨ JVM ä¹‹ä¸Š
2. **æ€§èƒ½å¼€é”€**ï¼šJVM å’Œå®¿ä¸» OS çš„å±‚æ¬¡
3. **æ— æ³•ç›´æ¥æ§åˆ¶ç¡¬ä»¶**ï¼šMMUã€ä¸­æ–­æ§åˆ¶å™¨ç­‰
4. **å†…å­˜ç®¡ç†**ï¼šä¾èµ– JVM åƒåœ¾å›æ”¶

### ç®€åŒ–å®ç°

1. **é¡µè¡¨**ï¼šä½¿ç”¨ HashMap è€ŒéçœŸå®é¡µè¡¨ç»“æ„
2. **è¿›ç¨‹**ï¼šä½¿ç”¨ Java çº¿ç¨‹æ¨¡æ‹Ÿ
3. **ä¸­æ–­**ï¼šä½¿ç”¨ Timer æ¨¡æ‹Ÿæ—¶é’Ÿä¸­æ–­
4. **è®¾å¤‡**ï¼šä½¿ç”¨æ–‡ä»¶æ¨¡æ‹Ÿç£ç›˜

---

## ä»£ç ç»„ç»‡

### åŒ…ç»“æ„

```
jinux/
â”œâ”€â”€ boot/              # å¯åŠ¨å¼•å¯¼
â”‚   â””â”€â”€ Bootstrap.java
â”œâ”€â”€ kernel/            # å†…æ ¸æ ¸å¿ƒ
â”‚   â”œâ”€â”€ Kernel.java
â”‚   â”œâ”€â”€ Task.java
â”‚   â”œâ”€â”€ Scheduler.java
â”‚   â”œâ”€â”€ Signal.java
â”‚   â””â”€â”€ SystemCallDispatcher.java
â”œâ”€â”€ mm/                # å†…å­˜ç®¡ç†
â”‚   â”œâ”€â”€ MemoryManager.java
â”‚   â”œâ”€â”€ PhysicalMemory.java
â”‚   â”œâ”€â”€ AddressSpace.java
â”‚   â””â”€â”€ PageTable.java
â”œâ”€â”€ fs/                # æ–‡ä»¶ç³»ç»Ÿ
â”‚   â”œâ”€â”€ VirtualFileSystem.java
â”‚   â”œâ”€â”€ Inode.java
â”‚   â”œâ”€â”€ SuperBlock.java
â”‚   â”œâ”€â”€ BufferCache.java
â”‚   â”œâ”€â”€ File.java
â”‚   â””â”€â”€ FileDescriptorTable.java
â”œâ”€â”€ drivers/           # è®¾å¤‡é©±åŠ¨
â”‚   â”œâ”€â”€ Device.java
â”‚   â”œâ”€â”€ CharDevice.java
â”‚   â”œâ”€â”€ BlockDevice.java
â”‚   â”œâ”€â”€ ConsoleDevice.java
â”‚   â”œâ”€â”€ VirtualDiskDevice.java
â”‚   â””â”€â”€ ClockDevice.java
â”œâ”€â”€ ipc/               # è¿›ç¨‹é—´é€šä¿¡
â”‚   â”œâ”€â”€ Pipe.java
â”‚   â””â”€â”€ PipeFile.java
â”œâ”€â”€ exec/              # ç¨‹åºæ‰§è¡Œ
â”‚   â””â”€â”€ ProgramLoader.java
â”œâ”€â”€ shell/             # Shell
â”‚   â””â”€â”€ SimpleShell.java
â”œâ”€â”€ lib/               # ç”¨æˆ·æ€åº“
â”‚   â”œâ”€â”€ LibC.java
â”‚   â””â”€â”€ *Example.java
â”œâ”€â”€ init/              # åˆå§‹åŒ–è¿›ç¨‹
â”‚   â””â”€â”€ InitProcess.java
â””â”€â”€ include/           # å…¬å…±å®šä¹‰
    â”œâ”€â”€ Const.java
    â”œâ”€â”€ Types.java
    â””â”€â”€ Syscalls.java
```

### ä»£ç ç»Ÿè®¡

- **æ€»æ–‡ä»¶æ•°**ï¼š33 ä¸ª Java æ–‡ä»¶
- **ä»£ç è¡Œæ•°**ï¼šçº¦ 7000+ è¡Œï¼ˆå«æ³¨é‡Šï¼‰
- **æ³¨é‡Šç‡**ï¼šçº¦ 35%
- **æ¨¡å—æ•°**ï¼š10 ä¸ªä¸»è¦æ¨¡å—
- **ç³»ç»Ÿè°ƒç”¨**ï¼š28 ä¸ª
- **Shell å‘½ä»¤**ï¼š12+ ä¸ª

---

## æ€»ç»“

Jinux é‡‡ç”¨æ¸…æ™°çš„åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œå®Œæ•´å®ç°äº†æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼š

âœ… **28 ä¸ªç³»ç»Ÿè°ƒç”¨**ï¼ˆ98% å®Œæˆåº¦ï¼‰  
âœ… **å®Œæ•´çš„è¿›ç¨‹ç®¡ç†**ï¼ˆè°ƒåº¦ã€forkã€COWï¼‰  
âœ… **å®Œæ•´çš„å†…å­˜ç®¡ç†**ï¼ˆè™šæ‹Ÿå†…å­˜ã€é¡µè¡¨ã€COWï¼‰  
âœ… **å®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿ**ï¼ˆVFSã€è·¯å¾„è§£æã€æ–‡ä»¶æ“ä½œï¼‰  
âœ… **Shell å¢å¼ºåŠŸèƒ½**ï¼ˆç®¡é“ã€é‡å®šå‘ã€åå°æ‰§è¡Œï¼‰  
âœ… **ç”¨æˆ·ç©ºé—´æ”¯æŒ**ï¼ˆæ•°æ®æ‹·è´ã€å‚æ•°ä¼ é€’ï¼‰  

Jinux æ˜¯ä¸€ä¸ªåŠŸèƒ½ç›¸å¯¹å®Œæ•´ã€æ¶æ„æ¸…æ™°ã€æ˜“äºç†è§£å’Œæ‰©å±•çš„æ“ä½œç³»ç»Ÿæ¨¡æ‹Ÿå™¨ï¼Œéå¸¸é€‚åˆç”¨äºå­¦ä¹ å’Œæ•™å­¦ã€‚

### æ¶æ„ç‰¹ç‚¹

1. **åˆ†å±‚æ¸…æ™°**ï¼šç”¨æˆ·æ€ã€å†…æ ¸æ€ã€ç¡¬ä»¶æŠ½è±¡å±‚åˆ†ç¦»æ˜ç¡®
2. **æ¨¡å—åŒ–è®¾è®¡**ï¼šå„æ¨¡å—èŒè´£å•ä¸€ï¼Œæ¥å£æ¸…æ™°
3. **æ˜“äºç†è§£**ï¼šé¢å‘å¯¹è±¡è®¾è®¡ï¼Œä»£ç å¯è¯»æ€§å¼º
4. **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ä¾¿äºæ·»åŠ æ–°åŠŸèƒ½
5. **é«˜åº¦è¿˜åŸ**ï¼šå¿ å®æ¨¡æ‹Ÿ Linux 0.01 çš„æ ¸å¿ƒæœºåˆ¶

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**æœ€åæ›´æ–°**ï¼š2024-12-23  
**ç»´æŠ¤è€…**ï¼šJinux Project Team

